Система ранжирования
====================

Зависимости
===========

-   C++14

-   UbjsonCpp - библиотека для работы протокола (repo:
    https://github.com/NightCodersss/UbjsonCpp)

-   cppunit - библиотека для unit-тестирования (используется в Ubjson)

Разработчику
============

Помимо информации, изложенной здесь, следует изучить документацию,
сгенерированную doxygen’ом (директории latex и html в корне проекта).

Структура {#subsec:generalStructure}
---------

Структура выглядит так: (Фронт-энд или другой сервис)
$\xrightarrow{Southern protocol}$ Ranking System
$\xrightarrow{Northern protocol}$ IndexServer Где $'\rightarrow'$
обозначет подключение от клиента к серверу.

Протокол
--------

В связи с тем, что Ubjson парсится на лету, не все поля обязательны. В
силу гибкости протокола незначительное изменение или значительное
добавление не должно требовать больших трудов. Что такое южный и
северный легко понять отсюда [subsec:generalStructure].

### Южный

Необходимо передавать строчку query, которая хранит в себе запрос.

    {
        query: "what is ...?"
    }

Планируется добавить параметры, каким образом представлять информацию о
документе обратно.

Заглушка работает так: слушает некоторый порт, по приходу данных, до
переноса строки ($\backslash n$), приходящие данные пакует в ubjson и
отправляет системе ранжирования. По приходу данных от системы
ранжирования (то есть системы поиска)(в ubjson) заглушка “их отвечает” в
json (обычном).

### Северный

Такой же, как “южный”, но с параметром - какой индекс использовать (по
какому тексту).

### Реализация

Ясно, что нехорошо ждать каждого ответа. Глобально, есть два пути
решения этой проблемы: использование асинхронных операций ввода-вывода
(с callback’ами) и использование большого количества потоков.
Существенных различий нет (нам известных), за исключением того, что код
с большим количеством callback’ов плохо читаем и некрасив.

Итак, реализация такова, что на каждое соединение выделется отдельный
поток, в котором соединение работает синхронно.

Программистам-пользователям
===========================

См. структуру [subsec:generalStructure]

Человеку, который запускает
===========================

См. структуру [subsec:generalStructure]

Конфигурация
------------

Пример конфига RankingServer’а:

    {
        "texts": [
            {
                "servers": [{"host": "localhost", "port": "14000"}],
                "factor": 1.8,
                "name": "The first text field",
                "index_id": "1",
            },
            {
                "servers": [{"host": "", "port": "14000"}],
                "factor": 0.9,
                "name": "Useless information",
                "index_id": "100400ab",
            },
        ]
    }
